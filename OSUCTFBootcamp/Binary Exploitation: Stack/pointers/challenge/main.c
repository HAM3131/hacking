#include <stdlib.h>
#include <string.h>
#include <stdio.h>
#include <stdint.h>

void examine(uint64_t* p) {
    printf("mem[%p] = %lx\n", p, *p);
}

int main(int argc, char *argv[]) {
    // Turn off stdout buffering so that IO works properly
    setvbuf(stdout, NULL, _IONBF, 0);

    char* flag = "osuctf{?????????????????????????????}";
    char* x = (char*)malloc(strlen(flag) + 1); // +1 for null byte at the end
    strcpy(x, flag);

    char** x1 = &x;
    char*** x2 = &x1;
    char**** x3 = &x2;
    char***** x4 = &x3;
    char****** x5 = &x4;
    char******* x6 = &x5;
    char******** x7 = &x6;
    char********* x8 = &x7;

    puts("Enter an address in hex and I'll tell you what it points to.");
    printf("Here's a good starting point: %p\n", x8);

    for (int i = 0; i < 32; ++i) {
        printf("> ");
        uint64_t* p;
        scanf("%p", &p);
        if (p == 0) {
            puts("Goodbye!");
            free(x);
            return 0;
        }
        examine(p);
    }

    puts("You used all your attempts. Goodbye!");
    free(x);
    return 0;
}
